<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CS Skin API</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: #0f0f13;
            color: #eee;
            font-family: 'Segoe UI', sans-serif;
            min-height: 100vh;
        }

        nav {
            background: #1a1a24;
            border-bottom: 1px solid #2a2a3a;
            padding: 0 40px;
            display: flex;
            align-items: center;
            gap: 32px;
            height: 60px;
        }

        .nav-logo {
            font-size: 1.3rem;
            font-weight: 800;
            color: #e94560;
            letter-spacing: 1px;
        }

        .nav-link {
            color: #888;
            text-decoration: none;
            font-size: 0.9rem;
            cursor: pointer;
            transition: color 0.2s;
        }

        .nav-link:hover, .nav-link.active { color: #eee; }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .page-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .page-subtitle {
            color: #666;
            margin-bottom: 32px;
            font-size: 0.9rem;
        }

        .search-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 12px;
        }

        .filter-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 32px;
            align-items: center;
        }

        .filter-label {
            color: #555;
            font-size: 0.85rem;
            white-space: nowrap;
        }

        input, select {
            background: #1a1a24;
            border: 1px solid #2a2a3a;
            border-radius: 6px;
            padding: 10px 16px;
            color: #eee;
            font-size: 0.95rem;
            outline: none;
            transition: border-color 0.2s;
        }

        input:focus, select:focus { border-color: #e94560; }
        input::placeholder { color: #444; }

        select {
            cursor: pointer;
            flex: 1;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23888' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 36px;
        }

        select option { background: #1a1a24; }

        button {
            background: #e94560;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 10px 24px;
            font-size: 0.95rem;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
            white-space: nowrap;
        }

        button:hover { background: #c73652; }

        .btn-clear {
            background: transparent;
            border: 1px solid #2a2a3a;
            color: #888;
            padding: 10px 16px;
        }

        .btn-clear:hover {
            border-color: #e94560;
            color: #eee;
            background: transparent;
        }

        .results-count {
            color: #555;
            font-size: 0.85rem;
            margin-bottom: 16px;
        }

        .skin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 16px;
        }

        .skin-card {
            background: #1a1a24;
            border: 1px solid #2a2a3a;
            border-radius: 10px;
            overflow: hidden;
            transition: border-color 0.2s, transform 0.2s;
            cursor: pointer;
        }

        .skin-card:hover {
            border-color: #e94560;
            transform: translateY(-2px);
        }

        .skin-image {
            background: linear-gradient(135deg, #1e1e2e, #2a1a2a);
            height: 140px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .skin-image img {
            height: 120px;
            object-fit: contain;
        }

        .skin-info { padding: 14px; }

        .skin-wear {
            font-size: 0.75rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .skin-name {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 12px;
            line-height: 1.3;
        }

        .skin-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .skin-price {
            color: #4ecca3;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .skin-listings {
            color: #555;
            font-size: 0.8rem;
        }

        .tag {
            display: inline-block;
            background: #2a1a2a;
            color: #e94560;
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 4px;
            margin-bottom: 6px;
            font-weight: 600;
        }

        .section-divider {
            border: none;
            border-top: 1px solid #2a2a3a;
            margin: 40px 0;
        }

        .budget-section h2 {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .budget-section p {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 24px;
        }

        .budget-inputs {
            display: flex;
            gap: 10px;
            margin-bottom: 24px;
        }

        .budget-summary {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
        }

        .summary-card {
            background: #1a1a24;
            border: 1px solid #2a2a3a;
            border-radius: 8px;
            padding: 16px 24px;
            flex: 1;
            text-align: center;
        }

        .summary-label {
            color: #555;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }

        .summary-value {
            font-size: 1.4rem;
            font-weight: 700;
            color: #4ecca3;
        }

        .loading { color: #555; padding: 20px 0; font-size: 0.9rem; }
        .error { color: #e94560; padding: 10px 0; font-size: 0.9rem; }

        .weapon-group-label {
            font-size: 0.75rem;
            color: #555;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
    </style>
</head>
<body>

    <nav>
        <div class="nav-logo">SKINAPI</div>
        <a class="nav-link active">Market</a>
        <a class="nav-link">Budget Tool</a>
    </nav>

    <div class="container">

        <div>
            <div class="page-title">CS2 Skin Market</div>
            <div class="page-subtitle">Live pricing data from Steam Marketplace</div>

            <div class="search-bar">
                <select id="weaponSelect">
                    <option value="">-- Select a Weapon --</option>
                    <optgroup label="RIFLES">
                        <option value="AK-47">AK-47</option>
                        <option value="M4A4">M4A4</option>
                        <option value="M4A1-S">M4A1-S</option>
                        <option value="AUG">AUG</option>
                        <option value="SG 553">SG 553</option>
                        <option value="FAMAS">FAMAS</option>
                        <option value="Galil AR">Galil AR</option>
                        <option value="AWP">AWP</option>
                        <option value="SSG 08">SSG 08</option>
                        <option value="SCAR-20">SCAR-20</option>
                        <option value="G3SG1">G3SG1</option>
                    </optgroup>
                    <optgroup label="PISTOLS">
                        <option value="Desert Eagle">Desert Eagle</option>
                        <option value="Glock-18">Glock-18</option>
                        <option value="USP-S">USP-S</option>
                        <option value="P2000">P2000</option>
                        <option value="P250">P250</option>
                        <option value="Five-SeveN">Five-SeveN</option>
                        <option value="Tec-9">Tec-9</option>
                        <option value="CZ75-Auto">CZ75-Auto</option>
                        <option value="Dual Berettas">Dual Berettas</option>
                        <option value="R8 Revolver">R8 Revolver</option>
                    </optgroup>
                    <optgroup label="SMGS">
                        <option value="MP9">MP9</option>
                        <option value="MAC-10">MAC-10</option>
                        <option value="MP7">MP7</option>
                        <option value="MP5-SD">MP5-SD</option>
                        <option value="UMP-45">UMP-45</option>
                        <option value="P90">P90</option>
                        <option value="PP-Bizon">PP-Bizon</option>
                    </optgroup>
                    <optgroup label="HEAVY">
                        <option value="Nova">Nova</option>
                        <option value="XM1014">XM1014</option>
                        <option value="Sawed-Off">Sawed-Off</option>
                        <option value="MAG-7">MAG-7</option>
                        <option value="M249">M249</option>
                        <option value="Negev">Negev</option>
                    </optgroup>
                    <optgroup label="KNIVES">
                        <option value="Karambit">Karambit</option>
                        <option value="Bayonet">Bayonet</option>
                        <option value="Butterfly Knife">Butterfly Knife</option>
                        <option value="Flip Knife">Flip Knife</option>
                        <option value="Gut Knife">Gut Knife</option>
                        <option value="Huntsman Knife">Huntsman Knife</option>
                        <option value="Falchion Knife">Falchion Knife</option>
                        <option value="Shadow Daggers">Shadow Daggers</option>
                        <option value="Bowie Knife">Bowie Knife</option>
                        <option value="Ursus Knife">Ursus Knife</option>
                        <option value="Navaja Knife">Navaja Knife</option>
                        <option value="Stiletto Knife">Stiletto Knife</option>
                        <option value="Talon Knife">Talon Knife</option>
                        <option value="Classic Knife">Classic Knife</option>
                        <option value="Paracord Knife">Paracord Knife</option>
                        <option value="Survival Knife">Survival Knife</option>
                        <option value="Nomad Knife">Nomad Knife</option>
                        <option value="Skeleton Knife">Skeleton Knife</option>
                    </optgroup>
                    <optgroup label="GLOVES">
                        <option value="Sport Gloves">Sport Gloves</option>
                        <option value="Driver Gloves">Driver Gloves</option>
                        <option value="Hand Wraps">Hand Wraps</option>
                        <option value="Moto Gloves">Moto Gloves</option>
                        <option value="Specialist Gloves">Specialist Gloves</option>
                        <option value="Hydra Gloves">Hydra Gloves</option>
                        <option value="Bloodhound Gloves">Bloodhound Gloves</option>
                        <option value="Broken Fang Gloves">Broken Fang Gloves</option>
                    </optgroup>
                </select>
                <button onclick="searchSkins()">Search</button>
            </div>

            <div class="filter-bar">
                <span class="filter-label">Price filter:</span>
                <input type="number" id="minPrice" placeholder="Min $" style="width: 100px;" />
                <input type="number" id="maxPrice" placeholder="Max $" style="width: 100px;" />
                <button class="btn-clear" onclick="clearFilters()">Clear</button>
            </div>

            <div class="results-count" id="resultsCount"></div>
            <div class="skin-grid" id="searchResults"></div>
        </div>

        <hr class="section-divider">

        <div class="budget-section">
            <h2>Budget Optimizer</h2>
            <p>Select a weapon and enter your budget â€” our knapsack algorithm finds the best combination of skins you can buy.</p>

            <div class="budget-inputs">
                <input type="number" id="budgetInput" placeholder="Budget in USD (e.g. 100)" style="width: 200px;" />
                <select id="budgetWeapon" style="flex: 1;">
                    <option value="">-- Select a Weapon --</option>
                    <optgroup label="RIFLES">
                        <option value="AK-47">AK-47</option>
                        <option value="M4A4">M4A4</option>
                        <option value="M4A1-S">M4A1-S</option>
                        <option value="AUG">AUG</option>
                        <option value="SG 553">SG 553</option>
                        <option value="FAMAS">FAMAS</option>
                        <option value="Galil AR">Galil AR</option>
                        <option value="AWP">AWP</option>
                        <option value="SSG 08">SSG 08</option>
                        <option value="SCAR-20">SCAR-20</option>
                        <option value="G3SG1">G3SG1</option>
                    </optgroup>
                    <optgroup label="PISTOLS">
                        <option value="Desert Eagle">Desert Eagle</option>
                        <option value="Glock-18">Glock-18</option>
                        <option value="USP-S">USP-S</option>
                        <option value="P2000">P2000</option>
                        <option value="P250">P250</option>
                        <option value="Five-SeveN">Five-SeveN</option>
                        <option value="Tec-9">Tec-9</option>
                        <option value="CZ75-Auto">CZ75-Auto</option>
                        <option value="Dual Berettas">Dual Berettas</option>
                        <option value="R8 Revolver">R8 Revolver</option>
                    </optgroup>
                    <optgroup label="SMGS">
                        <option value="MP9">MP9</option>
                        <option value="MAC-10">MAC-10</option>
                        <option value="MP7">MP7</option>
                        <option value="MP5-SD">MP5-SD</option>
                        <option value="UMP-45">UMP-45</option>
                        <option value="P90">P90</option>
                        <option value="PP-Bizon">PP-Bizon</option>
                    </optgroup>
                    <optgroup label="HEAVY">
                        <option value="Nova">Nova</option>
                        <option value="XM1014">XM1014</option>
                        <option value="Sawed-Off">Sawed-Off</option>
                        <option value="MAG-7">MAG-7</option>
                        <option value="M249">M249</option>
                        <option value="Negev">Negev</option>
                    </optgroup>
                    <optgroup label="KNIVES">
                        <option value="Karambit">Karambit</option>
                        <option value="Bayonet">Bayonet</option>
                        <option value="Butterfly Knife">Butterfly Knife</option>
                        <option value="Flip Knife">Flip Knife</option>
                        <option value="Gut Knife">Gut Knife</option>
                        <option value="Huntsman Knife">Huntsman Knife</option>
                        <option value="Falchion Knife">Falchion Knife</option>
                        <option value="Shadow Daggers">Shadow Daggers</option>
                        <option value="Bowie Knife">Bowie Knife</option>
                        <option value="Ursus Knife">Ursus Knife</option>
                        <option value="Navaja Knife">Navaja Knife</option>
                        <option value="Stiletto Knife">Stiletto Knife</option>
                        <option value="Talon Knife">Talon Knife</option>
                        <option value="Classic Knife">Classic Knife</option>
                        <option value="Paracord Knife">Paracord Knife</option>
                        <option value="Survival Knife">Survival Knife</option>
                        <option value="Nomad Knife">Nomad Knife</option>
                        <option value="Skeleton Knife">Skeleton Knife</option>
                    </optgroup>
                    <optgroup label="GLOVES">
                        <option value="Sport Gloves">Sport Gloves</option>
                        <option value="Driver Gloves">Driver Gloves</option>
                        <option value="Hand Wraps">Hand Wraps</option>
                        <option value="Moto Gloves">Moto Gloves</option>
                        <option value="Specialist Gloves">Specialist Gloves</option>
                        <option value="Hydra Gloves">Hydra Gloves</option>
                        <option value="Bloodhound Gloves">Bloodhound Gloves</option>
                        <option value="Broken Fang Gloves">Broken Fang Gloves</option>
                    </optgroup>
                </select>
                <button onclick="optimizeBudget()">Optimize</button>
            </div>

            <div id="budgetSummary"></div>
            <div class="skin-grid" id="budgetResults"></div>
        </div>

    </div>

    <script>
        const API = 'http://localhost:8080';

        function getWear(name) {
            if (name.includes('Factory New')) return 'Factory New';
            if (name.includes('Minimal Wear')) return 'Minimal Wear';
            if (name.includes('Field-Tested')) return 'Field-Tested';
            if (name.includes('Well-Worn')) return 'Well-Worn';
            if (name.includes('Battle-Scarred')) return 'Battle-Scarred';
            return '';
        }

        function getBaseName(name) {
            return name.replace(/\s*\(Factory New\)|\s*\(Minimal Wear\)|\s*\(Field-Tested\)|\s*\(Well-Worn\)|\s*\(Battle-Scarred\)/g, '');
        }

        function skinCardHTML(name, priceText, listings, tag = '', iconUrl = '', marketUrl = '') {
            const wear = getWear(name);
            const baseName = getBaseName(name);
            return `
                <a href="${marketUrl}" target="_blank" style="text-decoration:none; color:inherit;">
                    <div class="skin-card">
                        <div class="skin-image">
                            ${iconUrl
                                ? `<img src="${iconUrl}" alt="${baseName}" />`
                                : '<span style="font-size:2rem;color:#333;">?</span>'}
                        </div>
                        <div class="skin-info">
                            ${tag ? `<div class="tag">${tag}</div>` : ''}
                            <div class="skin-wear">${wear}</div>
                            <div class="skin-name">${baseName}</div>
                            <div class="skin-footer">
                                <div class="skin-price">${priceText}</div>
                                <div class="skin-listings">${listings} listings</div>
                            </div>
                        </div>
                    </div>
                </a>
            `;
        }

        function clearFilters() {
            document.getElementById('minPrice').value = '';
            document.getElementById('maxPrice').value = '';
            searchSkins();
        }

        async function searchSkins() {
            const q = document.getElementById('weaponSelect').value;
            const minPrice = document.getElementById('minPrice').value || 0;
            const maxPrice = document.getElementById('maxPrice').value || 999999;
            const resultsDiv = document.getElementById('searchResults');
            const countDiv = document.getElementById('resultsCount');

            if (!q) {
                resultsDiv.innerHTML = '<p class="error">Please select a weapon.</p>';
                return;
            }

            resultsDiv.innerHTML = '<p class="loading">Searching... this may take a few seconds.</p>';
            countDiv.textContent = '';

            try {
                const res = await fetch(`${API}/search?q=${encodeURIComponent(q)}&min=${minPrice}&max=${maxPrice}`);
                const data = await res.json();

                if (!data.results || data.results.length === 0) {
                    resultsDiv.innerHTML = '<p class="error">No skins found in that price range.</p>';
                    return;
                }

                countDiv.textContent = `Showing ${data.results.length} results`;

                resultsDiv.innerHTML = data.results.map(skin => {
                    const tag = skin.name.includes('StatTrak') ? 'StatTrak' : '';
                    return skinCardHTML(skin.name, skin.sell_price_text, skin.sell_listings, tag, skin.icon_url, skin.market_url);
                }).join('');

            } catch (e) {
                resultsDiv.innerHTML = '<p class="error">Failed to fetch. Is the server running?</p>';
            }
        }

        async function optimizeBudget() {
            const budget = parseFloat(document.getElementById('budgetInput').value);
            const query = document.getElementById('budgetWeapon').value;
            const resultsDiv = document.getElementById('budgetResults');
            const summaryDiv = document.getElementById('budgetSummary');

            if (!budget || !query) {
                resultsDiv.innerHTML = '<p class="error">Please enter a budget and select a weapon.</p>';
                return;
            }

            resultsDiv.innerHTML = '<p class="loading">Running knapsack optimization...</p>';
            summaryDiv.innerHTML = '';

            try {
                const res = await fetch(`${API}/budget/optimize`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ budget, query })
                });
                const data = await res.json();

                if (data.error) {
                    resultsDiv.innerHTML = `<p class="error">${data.error}</p>`;
                    return;
                }

                if (!data.skins || data.skins.length === 0) {
                    resultsDiv.innerHTML = '<p class="error">No skins found within budget.</p>';
                    return;
                }

                summaryDiv.innerHTML = `
                    <div class="budget-summary">
                        <div class="summary-card">
                            <div class="summary-label">Budget</div>
                            <div class="summary-value">$${data.budget.toFixed(2)}</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-label">Total Spent</div>
                            <div class="summary-value">$${data.total_spent.toFixed(2)}</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-label">Remaining</div>
                            <div class="summary-value">$${data.remaining.toFixed(2)}</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-label">Skins</div>
                            <div class="summary-value">${data.skins.length}</div>
                        </div>
                    </div>
                `;

                resultsDiv.innerHTML = data.skins.map(skin => {
                    const tag = skin.name.includes('StatTrak') ? 'StatTrak' : '';
                    return skinCardHTML(skin.name, skin.price, skin.listings, tag, skin.icon_url, skin.market_url);
                }).join('');

            } catch (e) {
                resultsDiv.innerHTML = '<p class="error">Failed to fetch. Is the server running?</p>';
            }
        }
    </script>
</body>
</html>